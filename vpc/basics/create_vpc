#!/usr/bin/env bash

REGION="us-east-1"
CIDR_BLOCK="10.2.0.0/16"
VPC_NAME="my_VPC"

# Create VPC
echo "🔧 Creating VPC..."
aws ec2 create-vpc \
  --cidr-block "$CIDR_BLOCK" \
  --region $REGION \
  --tag-specifications "ResourceType=vpc,Tags=[{Key=Name,Value=$VPC_NAME}]" \
  --output json > vpc_output.json

# Extract VPC ID
VPC_ID=$(jq -r '.Vpc.VpcId' vpc_output.json)
echo "✅ Created VPC with ID: $VPC_ID"

echo "🔧 Creating Internet Gateway"
IGW_ID=$(aws ec2 create-internet-gateway --region $REGION --output json | jq -r '.InternetGateway.InternetGatewayId')
echo "✅ Created IGW with ID: $IGW_ID"

echo "🔗 Attaching IGW to VPC"
aws ec2 attach-internet-gateway \
  --internet-gateway-id $IGW_ID \
  --vpc-id $VPC_ID \
  --region $REGION
echo "✅ IGW $IGW_ID attached to VPC $VPC_ID"



echo "🏷️ Tagging IGW with Name: $VPC_NAME"
aws ec2 create-tags \
  --resources $IGW_ID \
  --tags Key=Name,Value=$VPC_NAME \
  --region $REGION
echo "✅ Tagged IGW $IGW_ID with Name: $VPC_NAME"